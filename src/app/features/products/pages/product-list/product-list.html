<section class="productos">

  <div class="header">
    <h2>Gestión de Productos</h2>

    <button class="btn-primary" routerLink="/app/products/nuevo"  *ngIf="api.can('productos_write')">
      <span class="material-icons">add</span>
      Agregar Producto
    </button>
  </div>

  <ng-container *ngIf="productos$ | async as productos; else cargandoTpl">

    <div class="card">
      <table class="tabla">
        <thead>
          <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Categoría</th>
            <th>Precio Venta</th>
            <th>Stock</th>
            <th>Estado</th>
            <th class="acciones-col" *ngIf="api.can('productos_write')">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let p of productos">
            <td>{{ p.codigo }}</td>
            <td>{{ p.nombre }}</td>
            <td>{{ p.categoria }}</td>
            <td>S/ {{ p.precioVenta | number:'1.2-2' }}</td>
            <td>{{ p.stockActual }}</td>
            <td>
              <span class="badge"
                    [ngClass]="p.estadoStock.toLowerCase()">
                {{ p.estadoStock }}
              </span>
            </td>

            <td class="acciones" *ngIf="api.can('productos_write')">
              <button class="icon edit" [routerLink]="['/app/products/editar', p.codigo]">
                <span class="material-icons">edit</span>
              </button>

              <button class="icon delete" (click)="eliminarProducto(p.id)">
                <span class="material-icons">delete</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <p *ngIf="productos.length === 0" class="empty">No hay productos registrados.</p>
    </div>

  </ng-container>

  <ng-template #cargandoTpl>
    <div class="loading">
      <span class="material-icons">hourglass_empty</span>
      Cargando...
    </div>
  </ng-template>

</section>
